{% extends 'base.html' %}
{% load static %}

{% block content %}

{% include 'navbar.html' %}

<div class="max-w-6xl mx-auto py-8">
    <!-- Header with large icon a title -->
    <div class="flex items-center mb-8">
        <svg class="h-16 w-16 text-gray-500 mr-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
             stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        <h1 class="text-3xl font-bold text-gray-700">Oblast</h1>
    </div>

    <!-- Tabs a add button -->
    <div class="flex">
        <div class="flex space-x-0.5">
            <button class="bg-pastel-brown text-gray-700 font-medium px-3 py-2 rounded-t-md shadow">Pracovní listy</button>
            <button class="bg-white text-gray-700 font-medium px-3 py-2 rounded-t-md shadow">Rostliny</button>
        </div>
        <button class="ml-auto bg-green-500 text-white rounded-t-md px-4 py-2 hover:bg-green-600 shadow" onclick="addTask()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Form container -->
    <div class="bg-white shadow-md rounded-b-md p-4">
        <h2 class="text-2xl font-bold text-gray-700 mb-4">Vytvořit pracovní list</h2>
        <form id="worksheetForm">
            <div class="flex items-center mb-4">
                <div class="w-1/2 pr-2">
                    <label for="name" class="block text-sm font-medium text-gray-700">Název</label>
                    <input type="text" id="name" name="name" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 focus:ring-green-500 focus:border-green-500" placeholder="Zadejte název">
                </div>
                <div class="w-1/2 pl-2">
                    <label for="target" class="block text-sm font-medium text-gray-700">Určeno pro</label>
                    <select id="target" name="target" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 focus:ring-green-500 focus:border-green-500">
                        <option value="">Vyberte možnost</option>
                        <option value="studenti">Studenti</option>
                        <option value="ucitele">Učitelé</option>
                    </select>
                </div>
            </div>

            <div id="tasksContainer"></div>

            <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Vytvořit</button>
        </form>

        <div class="flex items-center mb-4 mt-8">
            <h3 class="text-xl font-bold text-gray-700">Úlohy</h3>
            <button type="button" class="ml-4 bg-green-500 text-white rounded-full p-2 hover:bg-green-600" onclick="addTask()">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        {% include 'type1_form.html' %}
        {% include 'type2_form.html' %}
    </div>
</div>

<script>
    let taskCount = 0;

    function addTask() {
        taskCount++;
        const taskContainer = document.createElement('div');
        taskContainer.className = 'task-container mb-4 p-4 border border-gray-200 rounded-md';
        taskContainer.innerHTML = `
            <div class="flex items-center mb-4">
                <h4 class="text-lg font-bold text-gray-700 flex-1">${taskCount}. úloha</h4>
                <button type="button" class="ml-4 bg-red-500 text-white rounded-full p-2 hover:bg-red-600" onclick="removeTask(this)">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
            <div class="flex items-center mb-4">
                <div class="w-1/2 pr-2">
                    <label for="type${taskCount}" class="block text-sm font-medium text-gray-700">Typ</label>
                    <select id="type${taskCount}" name="type${taskCount}" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 focus:ring-green-500 focus:border-green-500" onchange="loadTaskForm(this, ${taskCount})">
                        <option value="">Vyberte typ</option>
                        <option value="type1">Typ 1</option>
                        <option value="type2">Typ 2</option>
                    </select>
                </div>
            </div>
            <div id="formContainer${taskCount}"></div>
        `;
        document.getElementById('tasksContainer').appendChild(taskContainer);
        updateTaskNumbers();
    }

    function removeTask(button) {
        button.parentElement.parentElement.remove();
        updateTaskNumbers();
    }

    function updateTaskNumbers() {
        const tasks = document.querySelectorAll('.task-container');
        tasks.forEach((task, index) => {
            task.querySelector('h4').textContent = `${index + 1}. úloha`;
        });
        taskCount = tasks.length;
    }

    function loadTaskForm(selectElement, taskId) {
        const type = selectElement.value;
        const formContainer = document.getElementById(`formContainer${taskId}`);
        formContainer.innerHTML = '';

        if (type) {
            fetch(`/load_task_form/${type}/`)
                .then(response => response.text())
                .then(html => formContainer.innerHTML = html);
        }
    }
</script>

{% endblock %}
